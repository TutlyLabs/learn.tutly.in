---
import RootLayout from "@layouts/RootLayout.astro";
import Page from "./page";
import type { User, Profile } from "@prisma/client";
import { createServerCaller } from "@/trpc/server";

const currentUser = Astro.locals.user;
if (!currentUser) return Astro.redirect("/sign-in");

const caller = await createServerCaller(Astro.request);

const userProfile = await caller.profile.getCurrentUserProfile({ id: currentUser.id });
---

<RootLayout title="Profile">
  <Page userProfile={userProfile as User & { profile: Profile }} client:load />
</RootLayout>
