---
import RootLayout from "@/layouts/RootLayout.astro";
import { createServerCaller } from "@/trpc/server";
import EvaluatePage from "./page";

const assignmentId = Astro.params.id!;
const submissionId = Astro.url.searchParams.get("submissionId");
const username = Astro.url.searchParams.get("username");
const user = Astro.locals.user;

if (user?.role === "STUDENT") {
  return Astro.redirect(`/assignments/${assignmentId}`);
}

const caller = await createServerCaller(Astro.request);
const { assignment, submission, filteredSubmissions } = await caller.assignments.getEvaluateData({
  assignmentId,
  username: username ?? "",
  submissionId: submissionId ?? "",
});
---

<RootLayout title="Evaluate">
  <EvaluatePage
    assignmentId={assignmentId}
    assignment={assignment}
    filteredSubmissions={filteredSubmissions}
    submissionId={submissionId ?? ""}
    username={username ?? ""}
    submission={submission}
    client:only="react"
  />
</RootLayout>
