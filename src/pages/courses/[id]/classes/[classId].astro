---
import RootLayout from "@/layouts/RootLayout.astro";
import { createServerCaller } from "@/trpc/server";
import ClassPage from "./page";

const currentUser = Astro.locals.user;
if (!currentUser) return Astro.redirect("/sign-in");

const classId = Astro.params.classId!;
const courseId = Astro.params.id!;

const caller = await createServerCaller(Astro.request);

const classesWithFolders = await caller.classes.getClassesWithFolders({
  courseId
});

const classDetails = await caller.classes.getClassDetails({
  id: classId
});

const initialNote = await caller.notes.getNote({
  objectId: classId,
  userId: currentUser.id
});

const bookmark = await caller.bookmarks.getBookmark({
  objectId: classId,
  userId: currentUser.id
});

const isBookmarked = bookmark ? true : false;
---

<RootLayout title="Classes" forceClose={true}>
  <ClassPage
    courseId={courseId}
    classId={classId}
    classesWithFolders={classesWithFolders}
    currentUser={currentUser}
    classDetails={classDetails}
    isBookmarked={isBookmarked}
    initialNote={initialNote}
    client:only="react"
  />
</RootLayout>
