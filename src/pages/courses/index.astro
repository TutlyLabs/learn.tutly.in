---
import RootLayout from "@layouts/RootLayout.astro";
import CoursesPage from "./page";
import { createServerCaller } from "@/trpc/server";

const currentUser = Astro.locals.user;
if (!currentUser) return Astro.redirect("/sign-in");

const caller = await createServerCaller(Astro.request);
const courses = await caller.courses.getUserCourses();

const publishedCourses = courses.filter((course) => course.isPublished);
const coursesFinal = currentUser.role === "INSTRUCTOR" ? courses : publishedCourses;
---

<RootLayout title="Courses">
    <CoursesPage coursesFinal={coursesFinal} currentUser={currentUser} client:only="react" />
</RootLayout>
