---
import RootLayout from "@/layouts/RootLayout.astro";
import { createServerCaller } from "@/trpc/server";
import Assignment from "./page.tsx";
const currentUser = Astro.locals.user!;

if (currentUser.role === "STUDENT") {
  return Astro.redirect("/assignments");
}
const caller = await createServerCaller(Astro.request);
const students = await caller.users.getStudentsOfMentor();
const courses = await caller.courses.getAllCoursesOfUser();
courses.forEach((course) => {
  course.classes.sort((a, b) => {
    return Number(a.createdAt) - Number(b.createdAt);
  });
});
---

<RootLayout title="Assignments">
  <Assignment students={students} courses={courses} currentUser={currentUser} client:load />
</RootLayout>
